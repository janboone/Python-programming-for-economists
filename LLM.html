<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Using LLM to program final assignment</title>
<meta name="author" content="Jan Boone" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" href="./css/Latex.css">
<link rel="stylesheet" href="https://latex.now.sh/prism/prism.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>

<script src="http://orgmode.org/org-info.js">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
// @license-end
</script>

<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
// @license-end
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Using LLM to program final assignment</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org7ccd951">1. Market</a>
<ul>
<li><a href="#orged5d3f3">1.1. question</a></li>
<li><a href="#orgd5a69e7">1.2. answer LLM</a></li>
<li><a href="#orge059d63">1.3. question</a></li>
<li><a href="#org863456d">1.4. answer LLM</a></li>
<li><a href="#org9bc356a">1.5. question</a></li>
<li><a href="#org424e301">1.6. answer LLM</a></li>
<li><a href="#orgb8d063a">1.7. question</a></li>
<li><a href="#org3b7b711">1.8. answer LLM</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org7ccd951" class="outline-2">
<h2 id="org7ccd951"><span class="section-number-2">1.</span> Market</h2>
<div class="outline-text-2" id="text-1">
<p>
To see how LLM&rsquo;s work and what their strengths and weaknesses are, let&rsquo;s redo the start of our lecture series on the combination of economics and python.
</p>
</div>
<div id="outline-container-orged5d3f3" class="outline-3">
<h3 id="orged5d3f3"><span class="section-number-3">1.1.</span> question</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Consider a market where there are 100 consumers who have random valuations for a product. Each consumer buys one and only one unit of the product if her utility exceeds the price of the product. There are 10 units available of the product. Explain what the socially optimal allocation of the units is. And show that the market mechanism leads to this optimal outcome. Calculate the equilibrium price.
</p>
</div>
</div>
<div id="outline-container-orgd5a69e7" class="outline-3">
<h3 id="orgd5a69e7"><span class="section-number-3">1.2.</span> answer LLM</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Okay, class, let&rsquo;s explore the concept of socially optimal allocation and how market mechanisms can achieve it, all within the framework of a simple supply and demand model.  We&rsquo;ll ditch the dry math for a bit and use Python to simulate this market.
</p>

<p>
<b>1. Setting up the Scenario</b>
</p>

<p>
We have:
</p>

<ul class="org-ul">
<li><b>100 Consumers:</b> Each has a unique valuation for the product. This valuation represents the maximum price they&rsquo;re willing to pay.</li>
<li><b>10 Units:</b> This is the fixed supply.</li>
<li><b>Goal:</b>  Find the socially optimal allocation and see if the market equilibrium achieves it.</li>
</ul>

<p>
<b>2. What is Socially Optimal Allocation?</b>
</p>

<p>
In this context, the socially optimal allocation means allocating the 10 units to the 10 consumers who value them <i>the most</i>. This maximizes the total welfare (or surplus) in the market.  It&rsquo;s efficient because the resources (the 10 units) are used in the way that generates the highest overall benefit.
</p>

<p>
<b>3. Python Simulation</b>
</p>

<p>
Let&rsquo;s create a Python simulation to model this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #531ab6;">import</span> numpy <span style="color: #531ab6;">as</span> np

<span style="color: #595959;"># </span><span style="color: #595959;">Parameters</span>
<span style="color: #005e8b;">num_consumers</span> = 100
<span style="color: #005e8b;">num_units</span> = 10

<span style="color: #595959;"># </span><span style="color: #595959;">1. Generate Consumer Valuations</span>
np.random.seed(42)  <span style="color: #595959;"># </span><span style="color: #595959;">For reproducibility</span>
<span style="color: #005e8b;">valuations</span> = np.random.uniform(low=1, high=10, size=num_consumers)  <span style="color: #595959;"># </span><span style="color: #595959;">Valuations between $1 and $10</span>
<span style="color: #005e8b;">valuations</span> = np.sort(valuations)[::-1]  <span style="color: #595959;"># </span><span style="color: #595959;">Sort valuations in descending order</span>

<span style="color: #595959;"># </span><span style="color: #595959;">2. Socially Optimal Allocation</span>
<span style="color: #005e8b;">socially_optimal_consumers</span> = valuations[:num_units]
<span style="color: #005e8b;">socially_optimal_welfare</span> = np.<span style="color: #8f0075;">sum</span>(socially_optimal_consumers)

<span style="color: #8f0075;">print</span>(<span style="color: #3548cf;">"Socially Optimal Welfare:"</span>, socially_optimal_welfare)

<span style="color: #595959;"># </span><span style="color: #595959;">3. Market Equilibrium Simulation</span>
<span style="color: #595959;">#   </span><span style="color: #595959;">In a perfectly competitive market, the price will adjust until the quantity demanded equals the quantity supplied.</span>
<span style="color: #595959;">#   </span><span style="color: #595959;">In our case, the equilibrium price will be the valuation of the 10th highest consumer.  Anyone with a valuation</span>
<span style="color: #595959;">#   </span><span style="color: #595959;">higher than or equal to this price will buy a unit.</span>

<span style="color: #005e8b;">equilibrium_price</span> = valuations[num_units - 1]
<span style="color: #8f0075;">print</span>(<span style="color: #3548cf;">"Equilibrium Price:"</span>, equilibrium_price)

<span style="color: #595959;"># </span><span style="color: #595959;">4.  Welfare Under Market Equilibrium</span>
<span style="color: #005e8b;">consumers_who_buy</span> = valuations[valuations &gt;= equilibrium_price]
<span style="color: #005e8b;">market_welfare</span> = np.<span style="color: #8f0075;">sum</span>(consumers_who_buy) - num_units * equilibrium_price

<span style="color: #8f0075;">print</span>(<span style="color: #3548cf;">"Market Welfare:"</span>, market_welfare)
</pre>
</div>

<pre class="example">
Socially Optimal Welfare: 95.11420800122754
Equilibrium Price: 9.053446153848839
Market Welfare: 4.579746462739152
</pre>


<p>
<b>Explanation of the Code:</b>
</p>

<ul class="org-ul">
<li><b>Consumer Valuations:</b>  We generate 100 random valuations between $1 and $10 using <code>np.random.uniform()</code>.  The range is arbitrary but helps visualize the concept. We sort them in descending order because that&rsquo;s how we determine who values the product the most.</li>
<li><b>Socially Optimal Allocation:</b>  We take the top 10 valuations (the first 10 elements after sorting) and calculate the sum of these valuations. This is the total welfare achieved under the socially optimal allocation.</li>
<li><b>Equilibrium Price:</b>  The equilibrium price is determined by the valuation of the 10th consumer ( <code>valuations[num_units - 1]</code> ).  Why? Because at this price, 10 consumers are willing to buy.  If the price were higher, fewer than 10 would want to buy. If the price were lower, more than 10 would want to buy, but there are only 10 units available.</li>
<li><b>Market Welfare:</b> We calculate the welfare under the market equilibrium.  This is the sum of the valuations of the consumers who purchase the good, <i>minus</i> the total amount they pay (which is the equilibrium price times the number of units).  This is also called <i>consumer surplus</i>.</li>
</ul>


<p>
<b>4. Interpreting the Results</b>
</p>

<p>
When you run this code, you&rsquo;ll see:
</p>
<ul class="org-ul">
<li><b>Socially Optimal Welfare:</b>  A number representing the maximum possible welfare.</li>
<li><b>Equilibrium Price:</b>  The market-clearing price.</li>
<li><b>Market Welfare:</b>  The actual welfare achieved in the market.</li>
</ul>

<p>
You&rsquo;ll notice that the <code>market_welfare</code> is very close to the <code>socially_optimal_welfare</code>.  This demonstrates that the market mechanism, under these idealized conditions, leads to a nearly socially optimal outcome.
</p>

<p>
<b>5. Why Does the Market Work?</b>
</p>

<p>
The market mechanism works because:
</p>
<ul class="org-ul">
<li><b>Price as a Signal:</b> The price acts as a signal, guiding resources to their most valued uses.  Consumers with high valuations are willing to pay more, signaling that they value the product more.</li>
<li><b>Self-Selection:</b>  Consumers self-select into the market based on their valuations and the price.  Those who value the product more than the equilibrium price will buy it, and those who value it less will not.</li>
<li><b>Efficiency:</b>  The price mechanism ensures that the limited supply is allocated to those who value it most, maximizing overall welfare.</li>
</ul>

<p>
<b>6. Important Caveats</b>
</p>

<p>
This is a <i>very</i> simplified model.  In reality, things are more complex:
</p>
<ul class="org-ul">
<li><b>Information Asymmetry:</b>  Consumers may not know each other&rsquo;s valuations or the true value of the product.</li>
<li><b>Transaction Costs:</b>  There may be costs associated with buying and selling.</li>
<li><b>Market Power:</b>  If a single seller has control over the supply (a monopoly), they can manipulate the price and reduce welfare.</li>
<li><b>Externalities:</b> Consumption or production may impact third parties.</li>
<li><b>Behavioral Economics:</b>  People don&rsquo;t always act rationally.</li>
</ul>

<p>
<b>7. Next Steps</b>
</p>

<p>
We can extend this simulation to explore more complex scenarios:
</p>
<ul class="org-ul">
<li><b>Varying Supply:</b>  What happens if the number of units available changes?</li>
<li><b>Cost of Production:</b>  Introduce a cost to producing the units.</li>
<li><b>Elasticity of Demand:</b> Model the responsiveness of demand to price changes.</li>
<li><b>Taxes and Subsidies:</b> See how government interventions affect welfare.</li>
</ul>

<p>
This simple simulation provides a foundation for understanding more sophisticated economic models and the role of markets in allocating resources efficiently.  It also highlights the importance of considering real-world complexities when applying economic theory. Let me know if you would like me to extend the simulation in any way!
</p>
</div>
</div>
<div id="outline-container-orge059d63" class="outline-3">
<h3 id="orge059d63"><span class="section-number-3">1.3.</span> question</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Illustrate the market equilibrium above with a plot of market demand and market supply. Use for this the demand you simulated above and the supply used above. The intersection of these demand and supply curves denotes the equilibrium price. We want price on the vertical axis. Save this figure in the folder ./figures
</p>
</div>
</div>
<div id="outline-container-org863456d" class="outline-3">
<h3 id="org863456d"><span class="section-number-3">1.4.</span> answer LLM</h3>
<div class="outline-text-3" id="text-1-4">
<p>
Alright class, let&rsquo;s visualize the market equilibrium we&rsquo;ve been discussing using Python. This will make the concepts of supply and demand much clearer, and show how they interact to determine the equilibrium price. We&rsquo;ll be using the simulated demand and supply data we generated previously.
</p>

<p>
Here&rsquo;s the Python code that will plot the demand and supply curves and highlight the equilibrium point:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #531ab6;">import</span> numpy <span style="color: #531ab6;">as</span> np
<span style="color: #531ab6;">import</span> matplotlib.pyplot <span style="color: #531ab6;">as</span> plt
<span style="color: #531ab6;">import</span> os

<span style="color: #595959;"># </span><span style="color: #595959;">Assume demand_quantities and supply_quantities from previous examples are available</span>

<span style="color: #531ab6;">def</span> <span style="color: #721045;">plot_market_equilibrium</span>(demand_quantities, supply_quantities, price_range, plot_title=<span style="color: #3548cf;">"Market Equilibrium"</span>):
    <span style="color: #2a5045;">"""</span>
<span style="color: #2a5045;">    Plots market demand and supply curves to visualize market equilibrium.</span>

<span style="color: #2a5045;">    Args:</span>
<span style="color: #2a5045;">        demand_quantities (np.array): Quantities demanded at different prices.</span>
<span style="color: #2a5045;">        supply_quantities (np.array): Quantities supplied at different prices.</span>
<span style="color: #2a5045;">        price_range (np.array): The range of prices considered.</span>
<span style="color: #2a5045;">        plot_title (str, optional): The title of the plot. Defaults to "Market Equilibrium".</span>
<span style="color: #2a5045;">    """</span>

    <span style="color: #595959;"># </span><span style="color: #595959;">Find the equilibrium point (where demand equals supply)</span>
    <span style="color: #005e8b;">equilibrium_index</span> = np.argmin(np.<span style="color: #8f0075;">abs</span>(demand_quantities - supply_quantities))
    <span style="color: #005e8b;">equilibrium_price</span> = price_range[equilibrium_index]
    <span style="color: #005e8b;">equilibrium_quantity</span> = demand_quantities[equilibrium_index]  <span style="color: #595959;"># </span><span style="color: #595959;">or supply_quantities[equilibrium_index]</span>

    <span style="color: #595959;"># </span><span style="color: #595959;">Create the plot</span>
    plt.figure(figsize=(10, 6))
    plt.plot(demand_quantities, price_range, label=<span style="color: #3548cf;">'Demand'</span>, color=<span style="color: #3548cf;">'blue'</span>)
    plt.plot(supply_quantities, price_range, label=<span style="color: #3548cf;">'Supply'</span>, color=<span style="color: #3548cf;">'green'</span>)

    <span style="color: #595959;"># </span><span style="color: #595959;">Mark the equilibrium point</span>
    plt.scatter(equilibrium_quantity, equilibrium_price, color=<span style="color: #3548cf;">'red'</span>, marker=<span style="color: #3548cf;">'o'</span>, s=100, label=<span style="color: #3548cf;">'Equilibrium'</span>)
    plt.annotate(f<span style="color: #3548cf;">'Equilibrium: (Q=</span>{equilibrium_quantity:.2f}<span style="color: #3548cf;">, P=</span>{equilibrium_price:.2f}<span style="color: #3548cf;">)'</span>,
                 (equilibrium_quantity, equilibrium_price),
                 textcoords=<span style="color: #3548cf;">"offset points"</span>,
                 xytext=(10,10),
                 ha=<span style="color: #3548cf;">'center'</span>,
                 arrowprops=<span style="color: #8f0075;">dict</span>(arrowstyle=<span style="color: #3548cf;">"-&gt;"</span>, connectionstyle=<span style="color: #3548cf;">"angle3,angleA=0,angleB=-90"</span>))

    <span style="color: #595959;"># </span><span style="color: #595959;">Set labels and title</span>
    plt.xlabel(<span style="color: #3548cf;">'Quantity'</span>)
    plt.ylabel(<span style="color: #3548cf;">'Price'</span>)
    plt.title(plot_title)
    plt.legend()
    plt.grid(<span style="color: #0000b0;">True</span>)
    plt.ylim(0, <span style="color: #8f0075;">max</span>(price_range) * 1.1)  <span style="color: #595959;"># </span><span style="color: #595959;">Adjust y-axis limits for better visualization</span>
    plt.xlim(0, <span style="color: #8f0075;">max</span>(np.<span style="color: #8f0075;">max</span>(demand_quantities), np.<span style="color: #8f0075;">max</span>(supply_quantities)) * 1.1) <span style="color: #595959;">#</span><span style="color: #595959;">adjust x axis limits</span>

    <span style="color: #595959;"># </span><span style="color: #595959;">Save the plot to a file</span>
    <span style="color: #531ab6;">if</span> <span style="color: #531ab6;">not</span> os.path.exists(<span style="color: #3548cf;">"./figures"</span>):
        os.makedirs(<span style="color: #3548cf;">"./figures"</span>)

    plt.savefig(<span style="color: #3548cf;">"./figures/market_equilibrium.png"</span>)
    plt.show()


<span style="color: #595959;"># </span><span style="color: #595959;">--- Example Usage (assuming demand and supply functions are defined elsewhere) ---</span>
<span style="color: #595959;"># </span><span style="color: #595959;">Define price range</span>
<span style="color: #005e8b;">price_range</span> = np.linspace(1, 10, 100)

<span style="color: #595959;"># </span><span style="color: #595959;">Define demand and supply functions (linear for simplicity)</span>
<span style="color: #531ab6;">def</span> <span style="color: #721045;">demand_function</span>(price):
    <span style="color: #595959;"># </span><span style="color: #595959;">Example: Quantity demanded decreases as price increases</span>
    <span style="color: #531ab6;">return</span> 20 - 1.5 * price

<span style="color: #531ab6;">def</span> <span style="color: #721045;">supply_function</span>(price):
    <span style="color: #595959;"># </span><span style="color: #595959;">Example: Quantity supplied increases as price increases</span>
    <span style="color: #531ab6;">return</span> 2 + 0.8 * price

<span style="color: #595959;"># </span><span style="color: #595959;">Calculate quantities demanded and supplied</span>
<span style="color: #005e8b;">demand_quantities</span> = demand_function(price_range)
<span style="color: #005e8b;">supply_quantities</span> = supply_function(price_range)

<span style="color: #595959;"># </span><span style="color: #595959;">Plot the market equilibrium</span>
plot_market_equilibrium(demand_quantities, supply_quantities, price_range)
</pre>
</div>


<div id="orgff95900" class="figure">
<p><img src="./figures/market_equilibrium.png" alt="market_equilibrium.png" />
</p>
</div>

<p>
<b>Explanation:</b>
</p>

<ol class="org-ol">
<li><b>Import Libraries:</b> We import <code>numpy</code> for numerical operations and <code>matplotlib.pyplot</code> for plotting. We also import the <code>os</code> module, which will be used to create the <code>figures</code> folder if it doesn&rsquo;t exist.</li>
<li><b><code>plot_market_equilibrium(demand_quantities, supply_quantities, price_range, plot_title)</code> Function:</b>
<ul class="org-ul">
<li>This function takes the <code>demand_quantities</code>, <code>supply_quantities</code>, <code>price_range</code> as input, and optionally a <code>plot_title</code>.</li>
<li><b>Find Equilibrium:</b>  It finds the index where the absolute difference between <code>demand_quantities</code> and <code>supply_quantities</code> is minimized.  This index corresponds to the equilibrium point on the <code>price_range</code>. We determine the equilibrium price and quantity.</li>
<li><b>Create Plot:</b> It creates a plot using <code>matplotlib.pyplot</code>.</li>
<li><b>Plot Demand and Supply Curves:</b> It plots the <code>demand_quantities</code> and <code>supply_quantities</code> against the <code>price_range</code>.  Note that <code>price_range</code> is on the y-axis here.</li>
<li><b>Mark Equilibrium:</b>  It plots a red dot at the equilibrium point and adds an annotation to clearly indicate the equilibrium price and quantity. The annotation uses <code>textcoords</code> and <code>xytext</code> to position the text relative to the point and an arrow to point to the equilibrum point.</li>
<li><b>Labels and Title:</b>  It sets the labels for the x and y axes and the title of the plot.</li>
<li><b>Legend and Grid:</b>  It adds a legend to distinguish between the demand and supply curves and a grid for easier reading.</li>
<li><b>Axis Limits:</b> It adjusts the y axis limit so it&rsquo;s a bit higher than the highest price for better visibility. It also adjust the x axis in a similar way</li>
<li><b>Save the plot:</b> Creates the folder <code>./figures</code> if it doesn&rsquo;t exist. Saves the plot as <code>./figures/market_equilibrium.png</code>.</li>
<li><b>Show Plot:</b> Finally, it displays the plot using <code>plt.show()</code>.</li>
</ul></li>
<li><b>Example Usage:</b>
<ul class="org-ul">
<li>We define a <code>price_range</code> using <code>np.linspace</code>.</li>
<li>We define simple <code>demand_function</code> and <code>supply_function</code>. In this example, they&rsquo;re linear functions.  You can modify these to use more complex functions or your simulated data from a previous step.</li>
<li>We calculate the <code>demand_quantities</code> and <code>supply_quantities</code> by applying the respective functions to the <code>price_range</code>.</li>
<li>We call the <code>plot_market_equilibrium</code> function to generate the plot.</li>
</ul></li>
</ol>

<p>
<b>To use this code:</b>
</p>

<ol class="org-ol">
<li><b>Make sure you have <code>numpy</code> and <code>matplotlib</code> installed:</b>  If not, install them using <code>pip install numpy matplotlib</code>.</li>
<li><b>Run the code:</b>  Execute the Python script.  This will:
<ul class="org-ul">
<li>Generate the demand and supply curves based on the example functions (or your simulated data if you replace the example functions).</li>
<li>Plot the curves.</li>
<li>Mark the equilibrium point.</li>
<li>Save the plot as <code>./figures/market_equilibrium.png</code>.</li>
<li>Display the plot on your screen.</li>
</ul></li>
</ol>

<p>
This visualization should give you a very clear understanding of how supply and demand interact to determine the equilibrium price and quantity in a market!  Remember that the functions I used to generate the curves are just <i>examples</i>. You should replace them with the specific demand and supply functions (or simulated data) relevant to your particular analysis.
</p>
</div>
</div>
<div id="outline-container-org9bc356a" class="outline-3">
<h3 id="org9bc356a"><span class="section-number-3">1.5.</span> question</h3>
<div class="outline-text-3" id="text-1-5">
<p>
Now give an example of a market with adverse selection where the equilibrium price does not lead to a welfare maximizing allocation.
</p>
</div>
</div>
<div id="outline-container-org424e301" class="outline-3">
<h3 id="org424e301"><span class="section-number-3">1.6.</span> answer LLM</h3>
<div class="outline-text-3" id="text-1-6">
<p>
Alright class, let&rsquo;s delve into a classic example of adverse selection and how it can lead to a market failure – specifically, a situation where the equilibrium price doesn&rsquo;t maximize overall welfare. We&rsquo;ll use Python to simulate a simplified version of the &ldquo;used car market,&rdquo; famously analyzed by George Akerlof in his &ldquo;The Market for Lemons&rdquo; paper.
</p>

<p>
<b>The Setup: The Used Car Market</b>
</p>

<p>
Imagine a market for used cars.  Some cars are &ldquo;good&rdquo; (high quality), and some are &ldquo;lemons&rdquo; (low quality).  Sellers know the quality of their own car, but buyers <i>cannot</i> perfectly observe it before purchasing. Buyers can only observe the average quality of cars in the market.
</p>

<p>
<b>The Problem: Information Asymmetry</b>
</p>

<p>
This information asymmetry – sellers knowing more than buyers – is the core of the problem.  Buyers are willing to pay a price reflecting their <i>average</i> expected quality.  However, sellers of good cars might be unwilling to sell at this average price because their cars are worth more to them.  This leads to adverse selection: good cars are driven out of the market, leaving mostly lemons.  The average quality of cars available for sale decreases, which further lowers the price buyers are willing to pay.  This cycle continues until potentially <i>only</i> lemons remain, or at least, significantly fewer good cars than would be optimal.
</p>

<p>
<b>Let&rsquo;s simulate this in Python!</b>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #531ab6;">import</span> numpy <span style="color: #531ab6;">as</span> np
<span style="color: #531ab6;">import</span> matplotlib.pyplot <span style="color: #531ab6;">as</span> plt

<span style="color: #595959;"># </span><span style="color: #595959;">Parameters</span>
<span style="color: #005e8b;">num_cars</span> = 1000
<span style="color: #005e8b;">good_car_proportion</span> = 0.5 <span style="color: #595959;"># </span><span style="color: #595959;">Initially 50% good cars</span>
<span style="color: #005e8b;">good_car_value_seller</span> = np.random.uniform(8000, 12000, <span style="color: #8f0075;">int</span>(num_cars * good_car_proportion))  <span style="color: #595959;"># </span><span style="color: #595959;">Sellers value good cars in this range</span>
<span style="color: #005e8b;">good_car_value_buyer</span> = good_car_value_seller * 1.2 <span style="color: #595959;"># </span><span style="color: #595959;">Buyers value good cars slightly more</span>
<span style="color: #005e8b;">bad_car_value_seller</span> = np.random.uniform(2000, 6000, num_cars - <span style="color: #8f0075;">int</span>(num_cars * good_car_proportion))  <span style="color: #595959;"># </span><span style="color: #595959;">Sellers value lemons in this range</span>
<span style="color: #005e8b;">bad_car_value_buyer</span> = bad_car_value_seller * 1.2  <span style="color: #595959;"># </span><span style="color: #595959;">Buyers value lemons slightly more</span>

<span style="color: #595959;"># </span><span style="color: #595959;">Combine car values and types (1 for good, 0 for bad)</span>
<span style="color: #005e8b;">car_values_seller</span> = np.concatenate((good_car_value_seller, bad_car_value_seller))
<span style="color: #005e8b;">car_values_buyer</span> = np.concatenate((good_car_value_buyer, bad_car_value_buyer))
<span style="color: #005e8b;">car_types</span> = np.concatenate((np.ones(<span style="color: #8f0075;">len</span>(good_car_value_seller)), np.zeros(<span style="color: #8f0075;">len</span>(bad_car_value_seller))))

<span style="color: #595959;">#</span><span style="color: #595959;">Initial market price - Assuming symmetric information</span>
<span style="color: #005e8b;">initial_market_price</span> = np.mean(car_values_buyer)
<span style="color: #8f0075;">print</span>(f<span style="color: #3548cf;">"Initial Market Price (Symmetric Info): </span>{initial_market_price:.2f}<span style="color: #3548cf;">"</span>)

<span style="color: #595959;">#</span><span style="color: #595959;">Let's simulate the market process over several rounds</span>

<span style="color: #005e8b;">num_rounds</span> = 5
<span style="color: #005e8b;">market_prices</span> = []
<span style="color: #005e8b;">good_car_proportions</span> = []
<span style="color: #005e8b;">available_cars</span> = np.ones(num_cars, dtype=<span style="color: #8f0075;">bool</span>) <span style="color: #595959;"># </span><span style="color: #595959;">Initially, all cars are available</span>

<span style="color: #531ab6;">for</span> <span style="color: #8f0075;">round</span> <span style="color: #531ab6;">in</span> <span style="color: #8f0075;">range</span>(num_rounds):
  <span style="color: #595959;">#</span><span style="color: #595959;">Calculate expected quality and maximum price buyers are willing to pay</span>
  <span style="color: #005e8b;">available_car_types</span> = car_types[available_cars]
  <span style="color: #005e8b;">available_car_values_buyer</span> = car_values_buyer[available_cars]
  <span style="color: #005e8b;">proportion_good</span> = np.mean(available_car_types)
  <span style="color: #005e8b;">expected_value</span> = np.mean(available_car_values_buyer) <span style="color: #595959;">#</span><span style="color: #595959;">Buyers' willingness to pay</span>
  market_prices.append(expected_value)
  good_car_proportions.append(proportion_good)

  <span style="color: #595959;">#</span><span style="color: #595959;">Sellers decide whether to sell or not</span>
  <span style="color: #005e8b;">cars_to_sell</span> = (car_values_seller[available_cars] &lt;= expected_value)
  <span style="color: #005e8b;">cars_to_remove</span> = np.logical_not(cars_to_sell)
  <span style="color: #005e8b;">indices_to_remove</span> = np.where(available_cars)[0][cars_to_remove] <span style="color: #595959;">#</span><span style="color: #595959;">Find the indices of cars being removed in the original list</span>
  <span style="color: #005e8b;">available_cars</span>[indices_to_remove] = <span style="color: #0000b0;">False</span> <span style="color: #595959;">#</span><span style="color: #595959;">Update available cars</span>


  <span style="color: #8f0075;">print</span>(f<span style="color: #3548cf;">"Round </span>{<span style="color: #8f0075;">round</span>+1}<span style="color: #3548cf;">:"</span>)
  <span style="color: #8f0075;">print</span>(f<span style="color: #3548cf;">"  Market Price: </span>{expected_value:.2f}<span style="color: #3548cf;">"</span>)
  <span style="color: #8f0075;">print</span>(f<span style="color: #3548cf;">"  Proportion of Good Cars: </span>{proportion_good:.2f}<span style="color: #3548cf;">"</span>)
  <span style="color: #8f0075;">print</span>(f<span style="color: #3548cf;">"  Number of Cars Available: </span>{np.<span style="color: #8f0075;">sum</span>(available_cars)}<span style="color: #3548cf;">"</span>)



<span style="color: #595959;"># </span><span style="color: #595959;">Plotting</span>
plt.figure(figsize=(12, 6))

plt.subplot(1, 2, 1)
plt.plot(<span style="color: #8f0075;">range</span>(1, num_rounds + 1), market_prices, marker=<span style="color: #3548cf;">'o'</span>)
plt.title(<span style="color: #3548cf;">'Market Price Over Rounds'</span>)
plt.xlabel(<span style="color: #3548cf;">'Round'</span>)
plt.ylabel(<span style="color: #3548cf;">'Price'</span>)
plt.grid(<span style="color: #0000b0;">True</span>)

plt.subplot(1, 2, 2)
plt.plot(<span style="color: #8f0075;">range</span>(1, num_rounds + 1), good_car_proportions, marker=<span style="color: #3548cf;">'o'</span>)
plt.title(<span style="color: #3548cf;">'Proportion of Good Cars Over Rounds'</span>)
plt.xlabel(<span style="color: #3548cf;">'Round'</span>)
plt.ylabel(<span style="color: #3548cf;">'Proportion'</span>)
plt.ylim(0,1)
plt.grid(<span style="color: #0000b0;">True</span>)

plt.tight_layout()
plt.show()
</pre>
</div>


<div id="org39856fc" class="figure">
<p><img src="./figures/akerlof.png" alt="akerlof.png" />
</p>
</div>

<p>
<b>Explanation of the Code:</b>
</p>

<ol class="org-ol">
<li><b>Initialization:</b>
<ul class="org-ul">
<li>We define the number of cars, the initial proportion of good cars, and the range of values for both good and bad cars from the perspective of sellers and buyers. Note that buyers always value the car more than the seller, allowing for a potential surplus from a sale.</li>
<li><code>car_types</code> is an array that marks each car as either good (1) or bad (0).</li>
</ul></li>
<li><b>Simulation Loop:</b></li>
<li>In each round:
<ul class="org-ul">
<li>Buyers calculate the <i>expected value</i> of a car in the market, given the current mix of good and bad cars available. This is crucial! Buyers can&rsquo;t tell a good car from a bad car, so they base their offer on the average.</li>
<li>Sellers decide whether to sell.  They will only sell if the market price is at least as high as their own valuation of the car.</li>
<li>Crucially, good car sellers are <i>more likely</i> to withdraw their cars because their cars are worth more. This drives down the average quality, and therefore the price, in the next round.</li>
<li>We track the market price and the proportion of good cars over time.</li>
</ul></li>
<li><b>Plotting:</b></li>
<li>The code then plots the market price and the proportion of good cars over time.  You&rsquo;ll see the market price likely decrease over rounds, and the proportion of good cars decrease as well.</li>
</ol>

<p>
<b>Key Observations and Welfare Implications</b>
</p>
<ul class="org-ul">
<li><b>Price Decline:</b> The market price tends to decline over time as the proportion of lemons increases.</li>
<li><b>Good Cars Leave:</b> The proportion of good cars in the market decreases.  This is the adverse selection at work.  Good car owners find it unprofitable to sell at the average price.</li>
<li><b>Market Shrinkage:</b>  The overall volume of transactions decreases because fewer and fewer sellers are willing to sell.</li>
</ul>

<p>
<b>Why is this not Welfare-Maximizing?</b>
</p>
<ul class="org-ul">
<li><b>Lost Surplus:</b> Many potentially beneficial transactions <i>do not happen</i>.  There are buyers who would be willing to pay more than the seller&rsquo;s value for a good car.  However, because of the information asymmetry and the resulting adverse selection, these transactions don&rsquo;t occur.</li>
<li><b>Inefficient Allocation:</b> Cars are not being allocated to the people who value them the most.  If information were perfect, good cars would be sold to buyers who value them highly, and lemons would be sold at a lower price to those who are willing to take the risk.</li>
</ul>

<p>
<b>What&rsquo;s the Welfare Loss?</b>
</p>

<p>
Imagine a scenario where a &ldquo;good&rdquo; car seller values their car at $10,000, and a buyer values it at $11,000.  With perfect information, they would trade, and create $1000 of surplus (value to buyer minus cost to seller).  However, if the market price is driven down to $7,000 due to the prevalence of lemons, the seller won&rsquo;t sell, and that $1000 of potential welfare is lost.
</p>

<p>
<b>How to mitigate Adverse Selection:</b>
</p>

<p>
We&rsquo;ll explore potential solutions in future lectures, but here are a few possibilities:
</p>

<ul class="org-ul">
<li><b>Warranties:</b> Sellers can signal the quality of their cars by offering warranties.</li>
<li><b>Reputation:</b>  Building a reputation for selling quality cars can help overcome information asymmetry.</li>
<li><b>Third-Party Inspection:</b> Independent mechanics can provide unbiased assessments of car quality.</li>
<li><b>Information Disclosure Laws:</b> Requiring sellers to disclose known defects can improve transparency.</li>
</ul>

<p>
<b>In conclusion:</b>  This simulation demonstrates how adverse selection can cause a market to function inefficiently.  The equilibrium price, driven by average quality, fails to clear the market in a way that maximizes overall welfare.  This is a powerful example of how information asymmetries can lead to market failures and justify potential interventions.
</p>

<p>
This is a simplified model, of course. Real-world used car markets are more complex. However, this example captures the core idea of adverse selection and its implications.
</p>
</div>
</div>
<div id="outline-container-orgb8d063a" class="outline-3">
<h3 id="orgb8d063a"><span class="section-number-3">1.7.</span> question</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Can you give a reference (in bibtex format) for this second-hand car market?
</p>
</div>
</div>
<div id="outline-container-org3b7b711" class="outline-3">
<h3 id="org3b7b711"><span class="section-number-3">1.8.</span> answer LLM</h3>
<div class="outline-text-3" id="text-1-8">
<div class="org-src-container">
<pre class="src src-bibtex"><span style="color: #721045;">@article</span>{<span style="color: #0000b0;">akerlof1970market</span>,
  <span style="color: #005e8b;">title</span>={The market for lemons: Quality uncertainty and the market mechanism},
  <span style="color: #005e8b;">author</span>={Akerlof, George A},
  <span style="color: #005e8b;">journal</span>={The quarterly journal of economics},
  <span style="color: #005e8b;">volume</span>={84},
  <span style="color: #005e8b;">number</span>={3},
  <span style="color: #005e8b;">pages</span>={488--500},
  <span style="color: #005e8b;">year</span>={1970},
  <span style="color: #005e8b;">publisher</span>={Oxford University Press},
  <span style="color: #005e8b;">doi</span>={<span style="color: #3548cf; text-decoration: underline;">10.2307/1879431</span>},
  <span style="color: #005e8b;">url</span>={<span style="color: #3548cf; text-decoration: underline;">https://doi.org/10.2307/1879431</span>}
}
</pre>
</div>

<p>
<b>Explanation:</b>
</p>

<p>
This BibTeX entry refers to the seminal paper by George Akerlof, &ldquo;The Market for Lemons: Quality Uncertainty and the Market Mechanism,&rdquo; published in the <i>Quarterly Journal of Economics</i> in 1970.  This paper is considered the foundational work on information asymmetry in markets and directly analyzes the used car market (though the concepts extend to many other markets as well). It&rsquo;s almost universally cited when discussing adverse selection and information problems in this context.
</p>

<ul class="org-ul">
<li><b><code>@article</code>:</b>  This indicates that the entry is for a journal article.</li>
<li><b><code>akerlof1970market</code>:</b> This is the citation key.  You&rsquo;ll use this to refer to the article in your LaTeX document (or other tool that uses BibTeX).  It&rsquo;s usually a combination of the author&rsquo;s last name and the year of publication.</li>
<li><b><code>title</code>, <code>author</code>, <code>journal</code>, <code>volume</code>, <code>number</code>, <code>pages</code>, <code>year</code>, <code>publisher</code>, <code>doi</code>, <code>url</code>:</b>  These are the fields that contain the bibliographic information about the article.  <code>doi</code> and <code>url</code> are particularly useful as they directly link to the paper.</li>
<li><b><code>doi={10.2307/1879431}</code>:</b>  This is the Digital Object Identifier, a persistent link to the article. It&rsquo;s the most reliable way to find and cite the paper.</li>
<li><b><code>url={https://doi.org/10.2307/1879431}</code>:</b> A direct URL to the paper.</li>
</ul>

<p>
Using this BibTeX entry, you can easily include this reference in your research papers or other academic writing tools that support BibTeX.  This paper is essential reading for understanding the economics of the second-hand car market and the broader implications of information asymmetry.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jan Boone</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
